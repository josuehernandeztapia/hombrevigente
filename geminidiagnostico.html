<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiagnósticoVigente AI - Blueprint Interactivo Definitivo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Fallback CDN si el principal falla
        if (typeof THREE === 'undefined') {
            console.warn('⚠️ CDN principal falló, cargando fallback...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/three@0.140.0/build/three.min.js';
            script.onload = () => console.log('✅ Fallback CDN cargado');
            script.onerror = () => console.error('❌ Fallback CDN también falló');
            document.head.appendChild(script);
        }
    </script>
    <!-- Cache buster para forzar recarga -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Chosen Palette: "Hombre Vigente" - A high-tech, premium dark theme inspired by the brand's logo. Features a dark gray/black background, brushed metal textures, and a vibrant electric blue accent with glow effects. -->
    <!-- Application Structure Plan: A narrative, single-page dashboard structure with a sticky top navigation. The flow is designed to guide the user from the high-level value proposition ("Visión") to the interactive core ("Demo"), followed by deep-dive sections ("Tecnología", "Negocio", "Roadmap"). This non-linear, thematic structure is more engaging and user-friendly than the original report's format, allowing different personas (investor, clinician, CTO) to access relevant information quickly. Key interactions include the patient archetype simulator, dynamic ROI calculator, and interactive charts. -->
    <!-- Visualization & Content Choices: 
        - Market Growth: Goal: Inform/Impress. Viz: Bar Chart (Chart.js) to show the massive market potential. Interaction: Hover tooltips. Justification: More impactful than static numbers.
        - Competitive Analysis: Goal: Compare. Viz: Radar Chart (Chart.js). Interaction: Hover tooltips. Justification: Visually demonstrates superiority across multiple vectors (tech, cost, model) more effectively than a table.
        - ROI Calculator: Goal: Persuade. Viz: Interactive Sliders + Dynamic Bar Chart (Chart.js) + KPI cards. Interaction: User-controlled sliders update the chart and ROI metrics in real-time. Justification: Turns an abstract claim (27.2x ROI) into a tangible, personalized financial model for the clinic owner.
        - Tech Pipeline: Goal: Organize/Explain. Viz: Numbered, styled HTML/CSS diagram. Interaction: Content appears on scroll. Justification: Clearly illustrates the complex data flow without needing SVG/Mermaid, making it accessible and easy to understand.
        - Roadmap: Goal: Change/Future-Pacing. Viz: Vertical timeline with HTML/CSS. Interaction: Current phase highlighted. Justification: Clearly communicates the strategic vision and milestones.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        :root {
            --bg-dark: #111827;
            --surface-dark: #1F2937;
            --surface-light: #374151;
            --text-light: #F3F4F6;
            --text-muted: #9CA3AF;
            --primary-blue: #04D9FF;
            --primary-blue-dark: #00AEEF;
            --accent-green: #34D399;
            --border-color: #4B5563;
            --danger-color: #F87171;
        }
        html {
            font-size: 16px;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
        }
        .text-primary { color: var(--primary-blue); }
        .bg-primary { background-color: var(--primary-blue); }
        .border-primary { border-color: var(--primary-blue); }
        .ring-primary { --tw-ring-color: var(--primary-blue); }
        .text-accent { color: var(--accent-green); }
        .bg-accent { background-color: var(--accent-green); }

        .btn-primary {
            background-color: var(--primary-blue);
            color: var(--bg-dark);
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(4, 217, 255, 0.3);
        }
        .btn-primary:hover {
            background-color: var(--primary-blue-dark);
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(4, 217, 255, 0.5);
        }
        .btn-secondary {
            background-color: transparent;
            color: var(--primary-blue);
            border: 1px solid var(--primary-blue);
            transition: all 0.3s ease;
        }
        .btn-secondary:hover, .view-btn.active {
            background-color: rgba(4, 217, 255, 0.1);
            transform: translateY(-2px);
        }
        .view-btn {
            padding: 12px 20px;
            font-size: 14px;
            min-height: 44px;
            transition: all 0.3s ease;
        }
        .view-btn.active {
             background-color: var(--primary-blue);
             color: var(--bg-dark);
             font-weight: 600;
        }
        
        @media (max-width: 640px) {
            .view-btn {
                padding: 16px 24px;
                font-size: 16px;
                width: 100%;
                margin-bottom: 8px;
                min-height: 48px;
            }
        }
        .nav-link {
            position: relative;
            transition: color 0.3s ease;
            color: var(--text-muted);
        }
        .nav-link.active, .nav-link:hover {
            color: var(--primary-blue);
            text-shadow: 0 0 10px rgba(4, 217, 255, 0.7);
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-blue);
            transition: width 0.3s ease;
        }
        .nav-link.active::after {
            width: 100%;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .kpi-card h3 {
            font-size: 2.5rem;
            line-height: 1.1;
            text-shadow: 0 0 15px rgba(52, 211, 153, 0.5);
        }
        @media (min-width: 1024px) {
            .kpi-card h3 {
                font-size: 3.5rem;
            }
        }
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .progress-bar-inner, .subscore-bar-inner {
            transition: width 1.5s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .flywheel-arrow {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .tech-toggle-label {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-muted);
        }
        .tech-toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        .tech-toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .tech-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--surface-light);
            transition: .4s;
            border-radius: 20px;
        }
        .tech-toggle-slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .tech-toggle-slider {
            background-color: var(--primary-blue);
        }
        input:checked + .tech-toggle-slider:before {
            transform: translateX(20px);
        }
        .technical-details {
            display: none;
            margin-top: 1rem;
            padding: 1.5rem;
            background-color: rgba(4, 217, 255, 0.05);
            border-radius: 0.5rem;
            border-left: 4px solid var(--primary-blue);
        }
        body.tech-mode .technical-details {
            display: block;
        }
        .technical-details h4 {
            color: var(--primary-blue);
            font-weight: 700;
            margin-bottom: 0.75rem;
        }
        .technical-details p, .technical-details li {
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.6;
        }
        .technical-details ul {
            list-style-position: inside;
            list-style-type: disc;
            margin-left: 0.5rem;
        }
        .technical-details code {
            background-color: var(--surface-dark);
            color: var(--primary-blue);
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.85rem;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: var(--surface-dark);
            margin: 10% auto;
            padding: 2rem;
            border: 1px solid var(--border-color);
            width: 80%;
            max-width: 600px;
            border-radius: 1rem;
            animation: slide-down 0.5s ease-out;
        }
        @keyframes slide-down {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .close-button {
            color: var(--text-muted);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        #threejs-container {
            position: relative;
            width: 100%;
            height: 450px; /* Altura fija */
            background-color: #111111;
            border-radius: 0.5rem;
            overflow: hidden;
            border: 1px solid var(--border-color);
            height: 60vh;
            min-height: 300px;
            max-height: 500px;
        }
        
        @media (max-width: 768px) {
            #threejs-container {
                height: 50vh;
                min-height: 250px;
                aspect-ratio: 4 / 3;
            }
        }
        #threejs-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        .visualization-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            color: white;
        }
        .matrix-effect {
            position: absolute;
            inset: 0;
            background: black;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.5s ease;
            font-family: monospace;
            font-size: 12px;
            z-index: 10;
        }
        .critical-alert {
            position: absolute;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(248, 113, 113, 0.8);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
            animation: pulse-alert 1.5s infinite;
            opacity: 0;
        }
        
        /* Métricas live responsivas */
        #live-metrics {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 10px;
            z-index: 20;
        }
        
        @media (max-width: 768px) {
            #live-metrics {
                top: 5px;
                left: 5px;
                font-size: 9px;
                padding: 6px;
                max-width: 120px;
            }
            
            .critical-alert {
                top: 0.5rem;
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }
        }
        
        /* Grid responsivo móvil-first */
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }
        
        @media (min-width: 1024px) {
            .demo-grid {
                grid-template-columns: 2fr 3fr;
            }
        }
        
        /* Breakpoints sistema móvil-first */
        @media (max-width: 639px) {
            .hero-title { 
                font-size: 2rem !important; 
                line-height: 1.1;
            }
            .chart-container { 
                height: 250px !important; 
            }
            .demo-section { 
                padding: 1rem !important; 
            }
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }
        
        @media (min-width: 640px) and (max-width: 767px) {
            .hero-title { 
                font-size: 2.5rem !important; 
            }
            .chart-container { 
                height: 280px !important; 
            }
        }
        
        @media (min-width: 768px) and (max-width: 1023px) {
            .hero-title { 
                font-size: 3rem !important; 
            }
            .chart-container { 
                height: 320px !important; 
            }
        }
        
        /* Navegación móvil mejorada */
        @media (max-width: 768px) {
            .nav-link {
                padding: 12px 16px;
                min-height: 44px;
                display: flex;
                align-items: center;
                font-size: 16px;
            }
            
            /* Hamburger menu más grande */
            .mobile-menu-button {
                min-height: 48px;
                min-width: 48px;
            }
            
            /* Formularios touch-friendly */
            input, button, select, textarea {
                min-height: 44px;
                font-size: 16px; /* Previene zoom en iOS */
            }
            
            /* Botones principales más grandes */
            .btn-primary, .btn-secondary {
                padding: 16px 24px;
                font-size: 16px;
                min-height: 48px;
            }
            
            /* Espaciado móvil */
            .py-20 {
                padding-top: 3rem !important;
                padding-bottom: 3rem !important;
            }
            
            .py-24 {
                padding-top: 4rem !important;
                padding-bottom: 4rem !important;
            }
        }
        
        /* Prevenir zoom accidental en inputs iOS */
        @media screen and (-webkit-min-device-pixel-ratio: 0) {
            select, textarea, input[type="text"], input[type="password"], 
            input[type="datetime"], input[type="datetime-local"], 
            input[type="date"], input[type="month"], input[type="time"], 
            input[type="week"], input[type="number"], input[type="email"], 
            input[type="url"], input[type="search"], input[type="tel"], 
            input[type="color"] {
                font-size: 16px;
            }
        }
        
        /* Mejoras de accesibilidad táctil */
        @media (hover: none) and (pointer: coarse) {
            /* Dispositivos touch - eliminar hover states */
            .btn-primary:hover, .btn-secondary:hover, .nav-link:hover {
                transform: none;
            }
            
            /* Estados activos más prominentes */
            .btn-primary:active {
                transform: scale(0.98);
                background-color: var(--primary-blue-dark);
            }
            
            .btn-secondary:active {
                transform: scale(0.98);
                background-color: rgba(4, 217, 255, 0.2);
            }
        }
            transition: opacity 0.5s ease;
            z-index: 20;
        }
        @keyframes pulse-alert {
            0%, 100% { transform: translateX(-50%) scale(1); box-shadow: 0 0 0 0 rgba(248, 113, 113, 0.7); }
            50% { transform: translateX(-50%) scale(1.05); box-shadow: 0 0 20px 10px rgba(248, 113, 113, 0); }
        }
        
        /* 🌟 EFECTOS AVANZADOS PARA VISUALIZACIÓN 3D */
        .glow-effect {
            box-shadow: 0 0 20px rgba(4, 217, 255, 0.5);
            animation: glow-pulse 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow-pulse {
            from { box-shadow: 0 0 20px rgba(4, 217, 255, 0.5); }
            to { box-shadow: 0 0 30px rgba(4, 217, 255, 0.8), 0 0 40px rgba(4, 217, 255, 0.3); }
        }
        
        .particle-trail {
            position: absolute;
            width: 2px;
            height: 2px;
            background: radial-gradient(circle, #04D9FF 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: particle-float 3s ease-in-out infinite;
        }
        
        @keyframes particle-float {
            0%, 100% { transform: translateY(0px) scale(1); opacity: 0.6; }
            50% { transform: translateY(-10px) scale(1.2); opacity: 1; }
        }
        
        .cinematic-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(4, 217, 255, 0.1) 50%,
                transparent 70%
            );
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .cinematic-overlay.active {
            opacity: 1;
            animation: cinematic-sweep 2s ease-in-out;
        }
        
        @keyframes cinematic-sweep {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
    </style>
</head>
<body class="antialiased">

    <header id="header" class="bg-black/50 backdrop-blur-lg sticky top-0 z-50 border-b border-gray-800">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <a href="#hero" class="text-2xl font-extrabold text-gray-200">HOMBRE<span class="text-primary">VIGENTE</span></a>
                </div>
                <div class="hidden md:flex items-center">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#vision" class="nav-link px-3 py-2 rounded-md text-sm font-medium">Visión</a>
                        <a href="#demo" class="nav-link px-3 py-2 rounded-md text-sm font-medium">Demo</a>
                        <a href="#tecnologia" class="nav-link px-3 py-2 rounded-md text-sm font-medium">Tecnología</a>
                        <a href="#negocio" class="nav-link px-3 py-2 rounded-md text-sm font-medium">Negocio</a>
                        <a href="#roadmap" class="nav-link px-3 py-2 rounded-md text-sm font-medium">Roadmap</a>
                    </div>
                </div>
                <div class="hidden md:flex items-center gap-4">
                    <label for="tech-mode-toggle" class="tech-toggle-label">
                        <span class="text-xs font-medium">Modo Técnico</span>
                        <div class="tech-toggle-switch">
                            <input type="checkbox" id="tech-mode-toggle">
                            <span class="tech-toggle-slider"></span>
                        </div>
                    </label>
                    <a href="#demo" class="btn-primary font-semibold px-4 py-2 rounded-lg text-sm">Probar Demo</a>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 focus:outline-none">
                        <span class="sr-only">Abrir menú principal</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
            </div>
        </nav>
        <div id="mobile-menu" class="md:hidden hidden bg-black/80">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#vision" class="block nav-link px-3 py-2 rounded-md text-base font-medium">Visión</a>
                <a href="#demo" class="block nav-link px-3 py-2 rounded-md text-base font-medium">Demo</a>
                <a href="#tecnologia" class="block nav-link px-3 py-2 rounded-md text-base font-medium">Tecnología</a>
                <a href="#negocio" class="block nav-link px-3 py-2 rounded-md text-base font-medium">Negocio</a>
                <a href="#roadmap" class="block nav-link px-3 py-2 rounded-md text-base font-medium">Roadmap</a>
                <div class="border-t border-gray-700 mt-2 pt-2">
                    <label for="tech-mode-toggle-mobile" class="tech-toggle-label px-3 py-2">
                        <span class="text-sm font-medium">Modo Técnico</span>
                        <div class="tech-toggle-switch">
                            <input type="checkbox" id="tech-mode-toggle-mobile">
                            <span class="tech-toggle-slider"></span>
                        </div>
                    </label>
                </div>
                <a href="#demo" class="block btn-primary w-full text-center mt-2 font-semibold px-4 py-2 rounded-lg text-sm">Probar Demo</a>
            </div>
        </div>
    </header>

    <main>
        <section id="hero" class="py-20 md:py-32 relative overflow-hidden">
            <div class="absolute inset-0 bg-grid-pattern opacity-10"></div>
            <div class="absolute inset-0 bg-radial-gradient"></div>
            <style>
                .bg-grid-pattern { background-image: linear-gradient(var(--border-color) 1px, transparent 1px), linear-gradient(to right, var(--border-color) 1px, var(--bg-dark) 1px); background-size: 40px 40px; }
                .bg-radial-gradient { background: radial-gradient(circle at 50% 50%, rgba(4, 217, 255, 0.15) 0%, transparent 70%); }
            </style>
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
                <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight leading-tight" style="text-shadow: 0 0 30px rgba(4, 217, 255, 0.5);">
                    <span class="block text-gray-200">El <span class="text-primary">Médico Aumentado</span> para la</span>
                    <span class="block text-primary">Estética de Alto Rendimiento.</span>
                </h1>
                <p class="mt-6 max-w-3xl mx-auto text-lg md:text-xl text-text-muted">
                    "DiagnósticoVigente AI redefine la estética masculina fusionando visión estructural 4K, mapas térmicos y una IA de última generación. Nuestro demo clínico muestra cómo, en segundos, identificamos áreas críticas, generamos métricas accionables y personalizamos tratamientos con precisión científica… a una fracción del costo del líder de mercado."
                </p>
                <div class="mt-8 flex justify-center gap-4">
                    <a href="#demo" class="btn-primary font-semibold px-8 py-3 rounded-lg text-base">Iniciar Demo Interactivo</a>
                    <a href="#tecnologia" class="btn-secondary font-semibold px-8 py-3 rounded-lg text-base">Ver la Tecnología</a>
                </div>
            </div>
        </section>

        <section id="vision" class="py-20 md:py-24 bg-surface-dark">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold tracking-tight text-primary" style="text-shadow: 0 0 20px rgba(4, 217, 255, 0.3);">Una Oportunidad de Mercado Exponencial</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-text-muted">El sector de la estética masculina está en un punto de inflexión, con un 62% de los hombres frustrados por la falta de soluciones basadas en datos. Estamos creando una nueva categoría para este mercado desatendido de $95 mil millones.</p>
                </div>
                <div class="grid md:grid-cols-2 gap-8 lg:gap-16 items-center">
                    <div class="fade-in">
                        <h3 class="text-2xl font-bold mb-4 text-gray-200">Crecimiento del Mercado de Estética Masculina</h3>
                        <p class="text-text-muted mb-6">El sector está en un punto de inflexión, con proyecciones que alcanzan los $95 mil millones para 2031. Este crecimiento no es solo en volumen, sino en la demanda de soluciones sofisticadas, personalizadas y basadas en datos, especialmente de una nueva generación de consumidores que rechazan el enfoque de "talla única".</p>
                        <div class="chart-container">
                            <canvas id="marketChart"></canvas>
                        </div>
                    </div>
                    <div class="fade-in">
                        <h3 class="text-2xl font-bold mb-4 text-gray-200">El Vacío Competitivo</h3>
                        <p class="text-text-muted mb-6">Los sistemas actuales son caros y superficiales (VISIA) o de baja fidelidad y no clínicos (Haut.AI). Nuestra plataforma ofrece una fusión única de datos de grado clínico (RGB+IR) con un modelo de negocio SaaS escalable, creando un foso competitivo imbatible.</p>
                        <div class="chart-container">
                            <canvas id="competitorChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="demo" class="py-20 md:py-24">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold tracking-tight text-primary" style="text-shadow: 0 0 20px rgba(4, 217, 255, 0.3);">Demo Interactivo: El Viaje Diagnóstico</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-text-muted">Esta es la experiencia central de DiagnósticoVigente AI. Siga los pasos para ver cómo transformamos un escaneo en un plan de tratamiento accionable y un ROI claro. Esta simulación demuestra cómo hacemos visible lo invisible, convirtiendo la incertidumbre en certeza clínica y financiera.</p>
                </div>

                <div class="bg-surface-dark p-6 md:p-10 rounded-2xl shadow-2xl border border-border-color">
                    <div class="demo-grid">
                        <div class="lg:col-span-2">
                            <h3 class="font-bold text-xl mb-4 text-gray-200">1. Seleccione un Arquetipo de Paciente</h3>
                            <div id="patient-selector" class="space-y-3"></div>

                            <div id="patient-info" class="mt-6 p-4 rounded-lg bg-surface-light hidden">
                                <h4 id="patient-name" class="font-bold text-lg text-primary"></h4>
                                <p id="patient-desc" class="text-sm text-text-light mt-1"></p>
                            </div>

                            <div id="scan-progress" class="mt-8 hidden">
                                <h3 class="font-bold text-xl mb-4 text-gray-200">2. Proceso de Diagnóstico en Vivo</h3>
                                <div id="scan-steps-container" class="space-y-4">
                                    <!-- Steps will be injected here by JS -->
                                </div>
                                <div class="mt-6 w-full bg-surface-light rounded-full h-2.5">
                                    <div id="progress-bar" class="bg-primary h-2.5 rounded-full progress-bar-inner" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-3">
                            <div id="results-view" class="hidden">
                                <h3 class="font-bold text-xl mb-4 text-gray-200">3. Resultados y Plan de Acción</h3>
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div class="bg-surface-light p-6 rounded-lg cursor-pointer border border-border-color" id="indice-card">
                                        <div class="text-center">
                                            <p class="text-sm font-medium text-accent">ÍNDICE VIGENTE</p>
                                            <p id="indice-vigente-score" class="text-6xl font-extrabold text-accent mt-1">0</p>
                                            <p id="indice-vigente-desc" class="text-xs text-text-muted mt-1"></p>
                                        </div>
                                        <div id="indice-breakdown" class="mt-4 space-y-3">
                                            <div>
                                                <div class="flex justify-between items-center text-sm mb-1">
                                                    <span class="font-medium text-text-muted">Salud Estructural</span>
                                                    <span id="estructural-score" class="font-bold text-primary">0/100</span>
                                                </div>
                                                <div class="w-full bg-gray-700 rounded-full h-2"><div id="estructural-bar" class="bg-primary h-2 rounded-full subscore-bar-inner" style="width: 0%"></div></div>
                                            </div>
                                            <div>
                                                <div class="flex justify-between items-center text-sm mb-1">
                                                    <span class="font-medium text-text-muted">Calidad de Piel</span>
                                                    <span id="piel-score" class="font-bold text-primary">0/100</span>
                                                </div>
                                                <div class="w-full bg-gray-700 rounded-full h-2"><div id="piel-bar" class="bg-primary h-2 rounded-full subscore-bar-inner" style="width: 0%"></div></div>
                                            </div>
                                            <div>
                                                <div class="flex justify-between items-center text-sm mb-1">
                                                    <span class="font-medium text-text-muted">Salud Biológica</span>
                                                    <span id="biologico-score" class="font-bold text-primary">0/100</span>
                                                </div>
                                                <div class="w-full bg-gray-700 rounded-full h-2"><div id="biologico-bar" class="bg-primary h-2 rounded-full subscore-bar-inner" style="width: 0%"></div></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bg-surface-light p-6 rounded-lg border border-border-color">
                                        <h4 class="font-bold text-primary mb-2">Plan Recomendado por IA</h4>
                                        <ul id="treatment-plan" class="space-y-1 text-sm text-text-light list-disc list-inside"></ul>
                                    </div>
                                </div>
                                <div class="mt-6">
                                    <h4 class="font-bold text-lg mb-2 text-gray-200">Visualización de Datos</h4>
                                    <div id="threejs-container" class="glow-effect">
                                        <div id="matrix-effect" class="matrix-effect"></div>
                                        <div id="critical-alert" class="critical-alert"></div>
                                        <div id="cinematic-overlay" class="cinematic-overlay"></div>
                                        <div id="emergency-controls" style="position: absolute; bottom: 10px; left: 10px; z-index: 100;">
                                            <button onclick="window.testThreeJS()" style="background: #374151; color: white; border: 1px solid #04D9FF; padding: 5px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; margin-right: 5px;">🔍 Test</button>
                                            <button onclick="window.forceRender()" style="background: #374151; color: white; border: 1px solid #34D399; padding: 5px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; margin-right: 5px;">🔄 Render</button>
                                            <button onclick="window.recreateThreeJS()" style="background: #374151; color: white; border: 1px solid #F87171; padding: 5px 10px; border-radius: 4px; font-size: 11px; cursor: pointer;">🛠️ Reset</button>
                                        </div>
                                    </div>
                                    <div class="flex flex-col sm:flex-row justify-center gap-2 mt-2">
                                        <button data-view="rgb" class="view-btn btn-secondary rounded-full">RGB</button>
                                        <button data-view="thermal" class="view-btn btn-secondary rounded-full">Térmico</button>
                                        <button data-view="fused" class="view-btn btn-secondary rounded-full">Fusión IA</button>
                                    </div>
                                </div>
                            </div>
                             <div id="demo-placeholder" class="flex items-center justify-center h-full bg-surface-light rounded-lg border-2 border-dashed border-border-color">
                                <p class="text-text-muted p-8 text-center">Seleccione un arquetipo para iniciar el diagnóstico.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="tecnologia" class="py-20 md:py-24 bg-surface-dark">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold tracking-tight text-primary" style="text-shadow: 0 0 20px rgba(4, 217, 255, 0.3);">Arquitectura para una Precisión Imbatible</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-text-muted">Esta sección detalla nuestro motor tecnológico: desde la innovadora fusión de datos hasta el cerebro de IA multi-modelo y el pipeline que lo orquesta todo. Esta es nuestra ventaja injusta, protegida por propiedad intelectual y diseñada para escalar.</p>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <!-- Fusión RGB + IR -->
                    <div class="fade-in p-6 bg-surface-light rounded-lg flex flex-col border border-border-color">
                        <div class="text-4xl font-extrabold text-primary mb-3">01</div>
                        <h3 class="font-bold text-lg mb-2 text-gray-200">Fusión RGB + IR</h3>
                        <p class="text-sm text-text-muted flex-grow">Capturamos la estructura visible y la biología invisible (inflamación, vascularización). Esta fusión de datos nos da una visión 360° de la salud de la piel.</p>
                        <button class="btn-secondary text-xs mt-4 w-full tech-details-btn">Ver Detalles Técnicos</button>
                        <div class="technical-details">
                            <h4>Justificación Científica y Clínica</h4>
                            <p>La termografía infrarroja (IR) es un método validado para detectar inflamación subclínica. Diferenciales de temperatura de <strong>+$1.5°C a +$5°C</strong> se correlacionan con procesos inflamatorios (Ref: PMC10744680). Nuestra fusión permite identificar estos patrones invisibles al ojo humano, lo que es crítico para:</p>
                            <ul>
                                <li><strong>Seguridad:</strong> Evitar inyectar rellenos en áreas con inflamación oculta.</li>
                                <li><strong>Precisión:</strong> Diferenciar entre una mancha solar (pigmento) y rosácea (vascular) para seleccionar el láser correcto.</li>
                            </ul>
                            <p>Esta capacidad de análisis predictivo es inaccesible para competidores basados solo en RGB.</p>
                        </div>
                    </div>
                    <!-- Índice Vigente -->
                    <div class="fade-in p-6 bg-surface-light rounded-lg flex flex-col border border-border-color">
                        <div class="text-4xl font-extrabold text-primary mb-3">02</div>
                        <h3 class="font-bold text-lg mb-2 text-gray-200">Índice Vigente™</h3>
                        <p class="text-sm text-text-muted flex-grow">Nuestra métrica propietaria y patentable. Traduce cientos de puntos de datos en una única puntuación accionable y estandariza la consulta.</p>
                        <button class="btn-secondary text-xs mt-4 w-full tech-details-btn">Ver Detalles Técnicos</button>
                        <div class="technical-details">
                            <h4>Propiedad Intelectual y Fórmula</h4>
                            <p>El Índice se protege mediante una estrategia dual: <strong>patentes de método</strong> para el proceso diagnóstico y <strong>secreto comercial</strong> para los pesos del algoritmo y los datasets de entrenamiento.</p>
                            <p>La fórmula central es:</p>
                            <p><code>Índice = (0.4 * S_estructural) + (0.3 * S_piel) + (0.3 * S_biológico)</code></p>
                            <p>Esta fórmula convierte una evaluación subjetiva en una ciencia cuantificable, creando una poderosa herramienta de venta y seguimiento.</p>
                        </div>
                    </div>
                    <!-- Cerebro IA Multi-Modelo -->
                    <div class="fade-in p-6 bg-surface-light rounded-lg flex flex-col border border-border-color">
                        <div class="text-4xl font-extrabold text-primary mb-3">03</div>
                        <h3 class="font-bold text-lg mb-2 text-gray-200">Cerebro IA Multi-Modelo</h3>
                        <p class="text-sm text-text-muted flex-grow">Un conjunto de IAs especialistas (ViT, YOLOv8, MediaPipe) trabajan en conjunto para una precisión diagnóstica superior al 94%.</p>
                        <button class="btn-secondary text-xs mt-4 w-full tech-details-btn">Ver Detalles Técnicos</button>
                        <div class="technical-details">
                            <h4>Conjunto de Especialistas</h4>
                            <ul>
                                <li><strong>ViT:</strong> Analiza la calidad de la piel con una precisión >94%, correlacionando texturas RGB con patrones térmicos.</li>
                                <li><strong>MediaPipe:</strong> Identifica 468 landmarks faciales para un mapeo topológico 3D de alta precisión, 7 veces más que alternativas como dlib.</li>
                                <li><strong>YOLOv8:</strong> Detecta contornos faciales (mandíbula, papada) con una precisión >96% para guiar tratamientos.</li>
                                <li><strong>Segformer:</strong> Aísla el vello facial para un análisis de piel sin interferencias.</li>
                            </ul>
                        </div>
                    </div>
                    <!-- Data Flywheel -->
                    <div class="fade-in p-6 bg-surface-light rounded-lg flex flex-col border border-border-color">
                        <div class="text-4xl font-extrabold text-primary mb-3">04</div>
                        <h3 class="font-bold text-lg mb-2 text-gray-200">Data Flywheel</h3>
                        <p class="text-sm text-text-muted flex-grow">Cada escaneo mejora la plataforma. Nuestro sistema se vuelve más inteligente con cada paciente, creando un efecto de red de datos inexpugnable.</p>
                        <button class="btn-secondary text-xs mt-4 w-full tech-details-btn">Ver Detalles Técnicos</button>
                        <div class="technical-details">
                            <h4>Motor de Mejora Continua</h4>
                            <p>El Data Flywheel es un sistema de auto-mejora que crea un <strong>Efecto de Red de Datos</strong>. El ciclo es:</p>
                            <ol class="list-decimal list-inside">
                                <li>Más escaneos generan más datos diversos.</li>
                                <li>Más datos conducen a modelos de IA más precisos (reentrenamiento automatizado en AWS SageMaker).</li>
                                <li>Modelos mejores ofrecen diagnósticos superiores.</li>
                                <li>Diagnósticos superiores atraen más clínicas y pacientes.</li>
                            </ol>
                            <p>Esto construye un foso competitivo que se ensancha exponencialmente, haciendo casi imposible que un competidor nos alcance.</p>
                        </div>
                    </div>
                </div>
                
                <div id="flywheel-visualization" class="mt-20 fade-in">
                    <h3 class="text-2xl font-bold text-center mb-2 text-gray-200">Nuestro Data Flywheel: Una Ventaja Exponencial</h3>
                    <p class="text-center text-text-muted max-w-3xl mx-auto mb-8">Cada escaneo mejora la plataforma para todos. Este ciclo de aprendizaje crea un foso competitivo que se profundiza con el tiempo, aumentando la precisión de nuestros modelos de forma continua.</p>
                    <div class="max-w-4xl mx-auto grid grid-cols-2 md:grid-cols-4 items-center gap-4 text-center">
                        <div class="p-4 bg-surface-light rounded-lg border border-border-color">
                            <p class="text-2xl">📥</p>
                            <p class="font-semibold mt-2">Más Escaneos</p>
                        </div>
                        <div class="text-primary text-3xl font-bold flywheel-arrow">&rarr;</div>
                        <div class="p-4 bg-surface-light rounded-lg border border-border-color">
                            <p class="text-2xl">🧠</p>
                            <p class="font-semibold mt-2">IA Más Inteligente</p>
                        </div>
                         <div class="text-accent text-3xl font-bold flywheel-arrow hidden md:block">&rarr;</div>
                         <div class="col-span-2 md:hidden border-t-2 border-dashed border-gray-700 my-4"></div>
                         <div class="col-span-2 md:hidden border-t-2 border-dashed border-gray-700 my-4"></div>
                         <div class="p-4 bg-surface-light rounded-lg border border-border-color">
                            <p class="text-2xl">📈</p>
                            <p class="font-semibold mt-2">Mejores Resultados</p>
                        </div>
                        <div class="text-primary text-3xl font-bold flywheel-arrow">&rarr;</div>
                        <div class="p-4 bg-surface-light rounded-lg border border-border-color">
                            <p class="text-2xl">👥</p>
                            <p class="font-semibold mt-2">Más Clientes</p>
                        </div>
                    </div>
                     <div class="mt-8 text-center bg-surface-light p-6 rounded-lg max-w-sm mx-auto border border-border-color">
                         <p class="text-lg font-semibold text-accent">Precisión Diagnóstica Proyectada</p>
                         <p id="flywheel-accuracy" class="text-5xl font-extrabold text-accent mt-2">87%</p>
                         <p class="text-sm text-text-muted mt-1">(Mejora con cada 1000 escaneos)</p>
                    </div>
                </div>
                 <div class="mt-20 fade-in">
                    <h3 class="text-2xl font-bold text-center mb-8 text-gray-200">Stack Tecnológico Escalable y Conforme</h3>
                    <div class="max-w-4xl mx-auto grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 text-center">
                        <div class="p-4 bg-surface-light rounded-lg border border-border-color"><p class="font-semibold">Next.js</p><p class="text-xs text-text-muted">Frontend</p></div>
                        <div class="p-4 bg-surface-light rounded-lg border border-border-color"><p class="font-semibold">FastAPI</p><p class="text-xs text-text-muted">Backend</p></div>
                        <div class="p-4 bg-surface-light rounded-lg border border-border-color"><p class="font-semibold">Python</p><p class="text-xs text-text-muted">IA/ML</p></div>
                        <div class="p-4 bg-surface-light rounded-lg border border-border-color"><p class="font-semibold">MongoDB</p><p class="text-xs text-text-muted">Base de Datos</p></div>
                        <div class="p-4 bg-surface-light rounded-lg col-span-2 md:col-span-1 border border-border-color"><p class="font-semibold">AWS</p><p class="text-xs text-text-muted">Cloud (HIPAA/GDPR)</p></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="negocio" class="py-20 md:py-24">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold tracking-tight text-primary" style="text-shadow: 0 0 20px rgba(4, 217, 255, 0.3);">Un Modelo de Negocio SaaS Imparable</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-text-muted">Nuestra visión va más allá de un solo producto. `DiagnósticoVigente AI` es el motor de la **"Fábrica AI-Nativa"**, un ecosistema completo para la operación de la "Clinic-in-a-Box" del futuro.</p>
                </div>
                <div class="max-w-5xl mx-auto fade-in">
                    <h3 class="text-2xl font-bold text-center mb-8 text-gray-200">El Ecosistema de Agentes IA de Hombre Vigente</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-surface-dark p-6 rounded-lg border border-border-color">
                            <h4 class="font-bold text-lg text-primary">DiagnósticoVigente AI</h4>
                            <p class="text-sm text-text-muted mt-2">El "Médico Aumentado". Análisis 3D y térmico para diagnósticos objetivos.</p>
                        </div>
                        <div class="bg-surface-dark p-6 rounded-lg border border-border-color">
                            <h4 class="font-bold text-lg text-primary">PersonaVigente AI</h4>
                            <p class="text-sm text-text-muted mt-2">El "Estratega Personal". Crea planes de tratamiento hiperpersonalizados.</p>
                        </div>
                        <div class="bg-surface-dark p-6 rounded-lg border border-border-color">
                            <h4 class="font-bold text-lg text-primary">OptiVigente AI</h4>
                            <p class="text-sm text-text-muted mt-2">El "Director de Orquesta". Optimiza agendas y recursos en tiempo real.</p>
                        </div>
                        <div class="bg-surface-dark p-6 rounded-lg border border-border-color">
                            <h4 class="font-bold text-lg text-primary">RiskGuard AI</h4>
                            <p class="text-sm text-text-muted mt-2">El "Guardián Financiero". Gestiona el riesgo del sistema BNPL.</p>
                        </div>
                        <div class="bg-surface-dark p-6 rounded-lg border border-border-color">
                            <h4 class="font-bold text-lg text-primary">ChatVigente AI</h4>
                            <p class="text-sm text-text-muted mt-2">El "Conserje del Cliente". Automatiza la comunicación y el seguimiento.</p>
                        </div>
                        <div class="bg-surface-dark p-6 rounded-lg border border-border-color">
                            <h4 class="font-bold text-lg text-primary">MarketingVigente AI</h4>
                            <p class="text-sm text-text-muted mt-2">El "Motor de Crecimiento". Optimiza la pauta publicitaria en tiempo real.</p>
                        </div>
                    </div>
                </div>
                <div class="mt-20 max-w-4xl mx-auto grid md:grid-cols-3 gap-8">
                    <div class="fade-in bg-surface-dark border border-border-color rounded-lg p-6 text-center hover:shadow-lg hover:border-primary transition">
                        <h4 class="font-bold text-lg text-primary">Essential</h4>
                        <p class="text-4xl font-bold my-4">$299<span class="text-base font-normal text-text-muted">/mes</span></p>
                        <p class="text-sm text-text-muted">Ideal para prácticas individuales o pequeñas (1-2 profesionales).</p>
                    </div>
                    <div class="fade-in border-2 border-primary rounded-lg p-6 text-center shadow-2xl relative bg-surface-dark" style="box-shadow: 0 0 30px rgba(4, 217, 255, 0.3);">
                        <div class="absolute top-0 -translate-y-1/2 left-1/2 -translate-x-1/2">
                            <span class="bg-primary text-bg-dark text-xs font-bold px-3 py-1 rounded-full">MÁS POPULAR</span>
                        </div>
                        <h4 class="font-bold text-lg text-primary">Professional</h4>
                        <p class="text-4xl font-bold my-4">$799<span class="text-base font-normal text-text-muted">/mes</span></p>
                        <p class="text-sm text-text-muted">Para clínicas medianas (3-5 profesionales) con integración EMR.</p>
                    </div>
                    <div class="fade-in bg-surface-dark border border-border-color rounded-lg p-6 text-center hover:shadow-lg hover:border-primary transition">
                        <h4 class="font-bold text-lg text-primary">Enterprise</h4>
                        <p class="text-4xl font-bold my-4">Custom</p>
                        <p class="text-sm text-text-muted">Para cadenas de clínicas y necesidades de multi-ubicación.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="roadmap" class="py-20 md:py-24 bg-surface-dark">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                 <div class="text-center mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold tracking-tight text-primary" style="text-shadow: 0 0 20px rgba(4, 217, 255, 0.3);">Hoja de Ruta: Del Prototipo a la Dominación Global</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-text-muted">Nuestra expansión sigue la estrategia del "Manual de Vuelo": perfeccionar el playbook "Clinic-in-a-Box" en un entorno controlado antes de una escala masiva y replicable.</p>
                </div>
                <div class="max-w-3xl mx-auto">
                    <div class="relative">
                        <div class="absolute left-4 md:left-1/2 w-0.5 h-full bg-border-color"></div>
                        <div class="fade-in relative pl-10 md:pl-0 mb-12">
                            <div class="md:flex items-center">
                                <div class="md:w-1/2 md:pr-8">
                                    <div class="p-6 bg-surface-light rounded-lg border border-border-color">
                                        <p class="text-accent font-bold">Fase 1: Incubadora (QRO)</p>
                                        <h4 class="text-xl font-bold mt-1 text-gray-200">Perfeccionar el Playbook</h4>
                                        <ul class="mt-2 text-sm text-text-light list-disc list-inside">
                                            <li>Lanzar 1ª ubicación en Querétaro.</li>
                                            <li>Validar unit economics y operaciones.</li>
                                            <li>Calibrar los 6 agentes de IA con datos reales.</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="hidden md:block absolute left-1/2 -translate-x-1/2 w-8 h-8 bg-accent rounded-full border-4 border-surface-dark"></div>
                            </div>
                        </div>
                        <div class="fade-in relative pl-10 md:pl-0 mb-12">
                            <div class="md:flex flex-row-reverse items-center">
                                <div class="md:w-1/2 md:pl-8">
                                    <div class="p-6 bg-surface-light rounded-lg border border-border-color">
                                        <p class="text-primary font-bold">Fase 2: Dominio Local</p>
                                        <h4 class="text-xl font-bold mt-1 text-gray-200">Validar Replicabilidad</h4>
                                        <ul class="mt-2 text-sm text-text-light list-disc list-inside">
                                            <li>Expandir a 3 ubicaciones en Querétaro.</li>
                                            <li>Probar sinergias de cluster (+20% eficiencia).</li>
                                            <li>Documentar el modelo "Clinic-in-a-Box".</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="hidden md:block absolute left-1/2 -translate-x-1/2 w-8 h-8 bg-primary rounded-full border-4 border-surface-dark"></div>
                            </div>
                        </div>
                        <div class="fade-in relative pl-10 md:pl-0 mb-12">
                            <div class="md:flex items-center">
                                <div class="md:w-1/2 md:pr-8">
                                     <div class="p-6 bg-surface-light rounded-lg border border-border-color">
                                        <p class="text-primary font-bold">Fase 3: Conquista Nacional</p>
                                        <h4 class="text-xl font-bold mt-1 text-gray-200">Escalar a Metrópolis</h4>
                                        <ul class="mt-2 text-sm text-text-light list-disc list-inside">
                                            <li>Expansión secuencial: MTY → CDMX → GDL.</li>
                                            <li>Alcanzar 5-7 sucursales rentables.</li>
                                            <li>Establecer liderazgo de marca en México.</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="hidden md:block absolute left-1/2 -translate-x-1/2 w-8 h-8 bg-primary rounded-full border-4 border-surface-dark"></div>
                            </div>
                        </div>
                         <div class="fade-in relative pl-10 md:pl-0">
                            <div class="md:flex flex-row-reverse items-center">
                                <div class="md:w-1/2 md:pl-8">
                                    <div class="p-6 bg-surface-light rounded-lg border border-border-color">
                                        <p class="text-text-muted font-bold">Fase 4: Cabeza de Playa LATAM</p>
                                        <h4 class="text-xl font-bold mt-1 text-gray-200">Expansión Internacional</h4>
                                        <ul class="mt-2 text-sm text-text-light list-disc list-inside">
                                            <li>Entrar a mercados clave (ej. Medellín, Santiago).</li>
                                            <li>Lanzar modelo de franquicia premium.</li>
                                            <li>Desplegar la plataforma SaaS "Clinic-in-a-Box".</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="hidden md:block absolute left-1/2 -translate-x-1/2 w-8 h-8 bg-gray-500 rounded-full border-4 border-surface-dark"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-surface-dark border-t border-border-color">
        <div class="container mx-auto py-8 px-4 sm:px-6 lg:px-8 text-center text-text-muted text-sm">
            <p>&copy; 2025 Hombre Vigente - DiagnósticoVigente AI. Todos los derechos reservados.</p>
            <p class="mt-2">Redefiniendo la estética masculina con precisión científica.</p>
        </div>
    </footer>
    
    <!-- Modal for Indice Vigente Formula -->
    <div id="formula-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-formula-modal">&times;</span>
            <h3 class="text-2xl font-bold text-primary mb-4">Fórmula del Índice Vigente™</h3>
            <p class="text-text-muted mb-4">El Índice Vigente es nuestra métrica propietaria que traduce un análisis complejo en una puntuación accionable. Se calcula de la siguiente manera:</p>
            <div class="bg-surface-light p-4 rounded-lg text-center border border-border-color">
                <p class="text-lg font-mono text-text-light">
                    Índice = (0.4 * S<sub>estructural</sub>) + (0.3 * S<sub>piel</sub>) + (0.3 * S<sub>biológico</sub>)
                </p>
            </div>
            <ul class="mt-6 space-y-2 text-sm text-text-light">
                <li><strong>S<sub>estructural</sub>:</strong> Mide la simetría y definición de contornos (YOLOv8, MediaPipe).</li>
                <li><strong>S<sub>piel</sub>:</strong> Evalúa la textura, arrugas y poros (Vision Transformer).</li>
                <li><strong>S<sub>biológico</sub>:</strong> Cuantifica la inflamación y salud vascular (datos térmicos IR).</li>
            </ul>
            <p class="mt-4 text-xs text-text-muted">Esta fórmula y sus pesos son parte de nuestro secreto comercial y están en proceso de protección de patente.</p>
        </div>
    </div>

    <script>
        // === VARIABLES GLOBALES SEGURAS ===
        let vizContainer = null;
        let matrixEffectEl = null;
        let criticalAlertEl = null;
        let scene = null;
        let camera = null;
        let renderer = null;
        let head = null;
        let hotspotsGroup = null;
        let currentView = 'rgb';
        let animationFrameId = null;

        document.addEventListener('DOMContentLoaded', function() {
            // === DEBUGGING CRÍTICO ===
            console.log('🌐 DOM Cargado');
            
            // Inicializar elementos DOM
            vizContainer = document.getElementById('threejs-container');
            matrixEffectEl = document.getElementById('matrix-effect');
            criticalAlertEl = document.getElementById('critical-alert');

            console.log('📦 Elementos DOM inicializados:', {
                vizContainer: !!vizContainer,
                matrixEffectEl: !!matrixEffectEl,
                criticalAlertEl: !!criticalAlertEl
            });
            
            console.log('📦 THREE disponible:', typeof THREE);
            
            // Test inmediato de Three.js
            setTimeout(() => {
                console.log('⏰ Después de timeout - THREE:', typeof THREE);
                if (typeof THREE === 'undefined') {
                    console.error('❌ THREE.js NO SE CARGÓ - CAMBIANDO CDN...');
                    if (vizContainer) {
                        vizContainer.innerHTML = '<div style="color: red; padding: 20px; text-align: center;">❌ CDN Three.js falló - Verificar conexión a internet</div>';
                    }
                } else {
                    console.log('✅ THREE.js cargado correctamente');
                    console.log('🔧 Versión THREE:', THREE.REVISION);
                }
            }, 500);
            
            // Chart.js dark mode defaults
            Chart.defaults.color = 'hsl(215, 25%, 70%)';
            Chart.defaults.borderColor = 'hsl(215, 14%, 34%)';

            const patientData = {
                'carlos': {
                    name: 'Carlos, el Rejuvenecedor',
                    description: '38 años, preocupado por las primeras líneas de expresión y la pérdida de definición facial.',
                    indice: 72,
                    subscores: { estructural: 85, piel: 65, biologico: 68 },
                    indiceDesc: 'Buen punto de partida, con áreas de mejora en textura y firmeza.',
                    plan: ['Toxina Botulínica (entrecejo, frente)', 'Relleno de Ácido Hialurónico (surcos nasogenianos)', 'Bioestimulador de colágeno (mejillas)'],
                    hotspots: [ { position: {x: 0.5, y: 0.8, z: 0.8}, message: 'INFLAMACIÓN DETECTADA' } ]
                },
                'javier': {
                    name: 'Javier, Gen X con Daño Solar',
                    description: '52 años, con daño solar visible, pérdida de volumen y flacidez en el tercio inferior.',
                    indice: 58,
                    subscores: { estructural: 60, piel: 50, biologico: 65 },
                    indiceDesc: 'Potencial significativo de mejora en pigmentación y estructura.',
                    plan: ['Láser fraccionado para textura y manchas', 'Relleno para restaurar pómulos y mentón', 'Hilos tensores para lifting no quirúrgico'],
                    hotspots: [ { position: {x: -0.7, y: 0.2, z: 0.9}, message: 'ZONA DE RIESGO VASCULAR' } ]
                },
                'eduardo': {
                    name: 'Eduardo, el Optimizador',
                    description: '29 años, busca masculinización facial, mejorar el contorno mandibular y la proyección del mentón.',
                    indice: 85,
                    subscores: { estructural: 90, piel: 88, biologico: 80 },
                    indiceDesc: 'Excelente base. Optimización enfocada en contornos y simetría.',
                    plan: ['Relleno de alta densidad (mandíbula y mentón)', 'Tratamiento para grasa submentoniana', 'Cuidado de la piel preventivo'],
                    hotspots: []
                }
            };

            let marketChartInstance, competitorChartInstance;

            function createMarketChart() {
                const ctx = document.getElementById('marketChart').getContext('2d');
                if (marketChartInstance) marketChartInstance.destroy();
                marketChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['2024', '2031 (Proyección)'],
                        datasets: [{
                            label: 'Tamaño del Mercado (B USD)',
                            data: [9.14, 95.08],
                            backgroundColor: ['rgba(4, 217, 255, 0.2)', 'rgba(52, 211, 153, 0.2)'],
                            borderColor: ['#04D9FF', '#34D399'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { 
                            y: { 
                                beginAtZero: true, 
                                title: { display: true, text: 'Billones de USD' },
                                grid: { color: 'rgba(75, 85, 99, 0.5)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            }

            function createCompetitorChart() {
                const ctx = document.getElementById('competitorChart').getContext('2d');
                if (competitorChartInstance) competitorChartInstance.destroy();
                competitorChartInstance = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['Precisión Clínica', 'Bajo Costo', 'Modelo SaaS', 'Datos Biológicos', 'Escalabilidad'],
                        datasets: [
                            {
                                label: 'DiagnósticoVigente AI',
                                data: [9, 8, 10, 9, 10],
                                backgroundColor: 'rgba(4, 217, 255, 0.2)',
                                borderColor: '#04D9FF',
                                pointBackgroundColor: '#04D9FF',
                            },
                            {
                                label: 'VISIA',
                                data: [7, 2, 1, 1, 4],
                                backgroundColor: 'rgba(156, 163, 175, 0.2)',
                                borderColor: '#9CA3AF',
                                pointBackgroundColor: '#9CA3AF',
                            },
                             {
                                label: 'Haut.AI',
                                data: [4, 10, 9, 0, 9],
                                backgroundColor: 'rgba(52, 211, 153, 0.2)',
                                borderColor: '#34D399',
                                pointBackgroundColor: '#34D399',
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'bottom', labels: { color: '#9CA3AF' } } },
                        scales: { 
                            r: { 
                                beginAtZero: true, 
                                max: 10, 
                                pointLabels: { font: { size: 10 }, color: '#F3F4F6' },
                                grid: { color: 'rgba(75, 85, 99, 0.5)' },
                                angleLines: { color: 'rgba(75, 85, 99, 0.5)' }
                            } 
                        }
                    }
                });
            }
            
            const patientSelector = document.getElementById('patient-selector');
            Object.keys(patientData).forEach(key => {
                const patient = patientData[key];
                const button = document.createElement('button');
                button.className = 'patient-btn w-full text-left p-3 rounded-lg border-2 border-transparent transition-all duration-300 bg-surface-light hover:border-primary';
                button.dataset.patient = key;
                button.innerHTML = `<span class="font-semibold text-gray-200">${patient.name.split(',')[0]}</span><span class="text-sm text-text-muted">, ${patient.name.split(',')[1]}</span>`;
                patientSelector.appendChild(button);
            });

            const patientInfo = document.getElementById('patient-info');
            const patientName = document.getElementById('patient-name');
            const patientDesc = document.getElementById('patient-desc');
            const scanProgress = document.getElementById('scan-progress');
            const resultsView = document.getElementById('results-view');
            const demoPlaceholder = document.getElementById('demo-placeholder');
            const scanStepsContainer = document.getElementById('scan-steps-container');

            patientSelector.addEventListener('click', function(e) {
                const button = e.target.closest('.patient-btn');
                if (button) {
                    // 🎵 SONIDO DE SELECCIÓN DE PACIENTE
                    playBeep(1000, 120);
                    
                    document.querySelectorAll('.patient-btn').forEach(btn => btn.classList.remove('bg-primary', 'border-primary', 'text-bg-dark'));
                    button.classList.add('bg-primary', 'border-primary', 'text-bg-dark');
                    startDiagnosis(button.dataset.patient);
                }
            });

            function startDiagnosis(patientKey) {
                const patient = patientData[patientKey];
                
                demoPlaceholder.classList.add('hidden');
                resultsView.classList.remove('hidden');
                
                patientName.textContent = patient.name;
                patientDesc.textContent = patient.description;
                patientInfo.classList.remove('hidden');
                scanProgress.classList.remove('hidden');
                
                // Hide results cards until scan is complete
                document.getElementById('indice-card').style.opacity = 0;
                document.querySelector('.bg-surface-light.p-6.rounded-lg.border.border-border-color:not(#indice-card)').style.opacity = 0;


                const progressBar = document.getElementById('progress-bar');
                const steps = [
                    { id: 'step-1', text: 'Captura RGB 4K + IR Térmico...', duration: 2000, progress: 25, model: null, view: 'rgb' },
                    { id: 'step-2', text: 'Reconstrucción 3D...', duration: 2000, progress: 50, model: 'MediaPipe', view: 'thermal' },
                    { id: 'step-3', text: 'Análisis IA Multi-Modelo...', duration: 2000, progress: 75, model: 'ViT, YOLOv8', view: 'fused' },
                    { id: 'step-4', text: 'Generando Índice Vigente™...', duration: 1000, progress: 100, model: null, view: 'fused' }
                ];

                scanStepsContainer.innerHTML = '';
                steps.forEach(step => {
                    scanStepsContainer.innerHTML += `
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-surface-light border border-border-color flex items-center justify-center font-bold text-primary" id="${step.id}-icon">${steps.indexOf(step) + 1}</div>
                            <div>
                                <span id="${step.id}-text" class="text-text-muted">${step.text}</span>
                                <div id="${step.id}-model" class="text-xs text-primary font-medium hidden"></div>
                            </div>
                        </div>
                    `;
                });
                
                let cumulativeDelay = 0;
                progressBar.style.width = '0%';
                
                // Start 3D visualization sequence
                runVisualizationSequence(patient, steps);

                steps.forEach((step, index) => {
                    setTimeout(() => {
                        // 🎵 SONIDO DE PROGRESO DIFERENCIADO
                        const frequencies = [400, 500, 600, 800];
                        playBeep(frequencies[index] || 600, 80);
                        
                        const iconEl = document.getElementById(`${step.id}-icon`);
                        const modelEl = document.getElementById(`${step.id}-model`);
                        
                        iconEl.classList.remove('bg-surface-light', 'border-border-color');
                        iconEl.classList.add('bg-accent', 'border-accent');
                        iconEl.innerHTML = `<span class="text-bg-dark font-bold">&#10003;</span>`;
                        progressBar.style.width = `${step.progress}%`;

                        if (step.model) {
                            modelEl.textContent = `(Modelo: ${step.model})`;
                            modelEl.classList.remove('hidden');
                        }

                        if (index === steps.length - 1) {
                            // 🎵 SONIDO DE FINALIZACIÓN TRIUNFAL
                            setTimeout(() => {
                                playBeep(1200, 200);
                                showResults(patient);
                            }, 300);
                        }
                    }, cumulativeDelay);
                    cumulativeDelay += step.duration;
                });
            }
            
            const indiceScoreEl = document.getElementById('indice-vigente-score');
            const indiceDescEl = document.getElementById('indice-vigente-desc');
            const treatmentPlanEl = document.getElementById('treatment-plan');

            function animateScore(scoreEl, barEl, targetScore, duration = 1500) {
                let currentScore = 0;
                const increment = targetScore / (duration / 20);
                
                barEl.style.width = '0%';
                scoreEl.textContent = `0/100`;

                setTimeout(() => {
                    barEl.style.width = `${targetScore}%`;
                    const interval = setInterval(() => {
                        currentScore += increment;
                        if (currentScore >= targetScore) {
                            currentScore = targetScore;
                            clearInterval(interval);
                        }
                        scoreEl.textContent = `${Math.round(currentScore)}/100`;
                    }, 20);
                }, 100);
            }

            function showResults(patient) {
                scanProgress.classList.add('hidden');
                
                // Animate in results cards
                const indiceCardEl = document.getElementById('indice-card');
                const planCardEl = document.querySelector('.bg-surface-light.p-6.rounded-lg.border.border-border-color:not(#indice-card)');
                indiceCardEl.style.transition = 'opacity 0.5s ease-in';
                planCardEl.style.transition = 'opacity 0.5s ease-in';
                indiceCardEl.style.opacity = 1;
                planCardEl.style.opacity = 1;

                let currentScore = 0;
                const targetScore = patient.indice;
                const increment = targetScore / 50;
                const interval = setInterval(() => {
                    currentScore += increment;
                    if (currentScore >= targetScore) {
                        currentScore = targetScore;
                        clearInterval(interval);
                    }
                    indiceScoreEl.textContent = Math.round(currentScore);
                }, 20);

                indiceDescEl.textContent = patient.indiceDesc;
                
                treatmentPlanEl.innerHTML = '';
                patient.plan.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    treatmentPlanEl.appendChild(li);
                });

                animateScore(
                    document.getElementById('estructural-score'),
                    document.getElementById('estructural-bar'),
                    patient.subscores.estructural
                );
                animateScore(
                    document.getElementById('piel-score'),
                    document.getElementById('piel-bar'),
                    patient.subscores.piel
                );
                animateScore(
                    document.getElementById('biologico-score'),
                    document.getElementById('biologico-bar'),
                    patient.subscores.biologico
                );
            }
            
            // Three.js Visualization Logic - Variables globales
            let vizContainer, matrixEffectEl, criticalAlertEl;
            
            // Variables de Three.js
            let scene, camera, renderer, head, hotspotsGroup;
            let currentView = 'rgb';
            let animationFrameId;

            function initThreeJS() {
                console.log('🚀 === INICIANDO THREE.JS MODO SEGURO ===');
                
                if (typeof THREE === 'undefined') {
                    console.error('❌ THREE.js NO DISPONIBLE');
                    if (vizContainer) {
                        vizContainer.innerHTML = '<div style="color: red; text-align: center; padding: 40px;">THREE.js no cargó</div>';
                    }
                    return;
                }

                if (!vizContainer) {
                    console.error('❌ Container no encontrado');
                    return;
                }

                // Limpiar container
                vizContainer.innerHTML = '';
                
                try {
                    // Detectar móvil para optimizaciones
                    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    
                    // Configuración básica
                    scene = new THREE.Scene();
                    
                    // Obtener dimensiones reales del container
                    const rect = vizContainer.getBoundingClientRect();
                    const width = rect.width || 640;
                    const height = rect.height || 360;
                    
                    camera = new THREE.PerspectiveCamera(75, width/height, 0.1, 1000);
                    camera.position.z = 3;
                    
                    // Renderer con optimizaciones móviles
                    const rendererConfig = isMobile ? 
                        { antialias: false, alpha: false, preserveDrawingBuffer: false } : 
                        { antialias: true };
                    
                    renderer = new THREE.WebGLRenderer(rendererConfig);
                    renderer.setSize(width, height);
                    renderer.setClearColor(0x222222);
                    vizContainer.appendChild(renderer.domElement);
                    
                    // Luces
                    const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
                    scene.add(ambientLight);
                    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                    directionalLight.position.set(1, 1, 1);
                    scene.add(directionalLight);
                    
                    // Modelo con optimización móvil
                    const geometryDetail = isMobile ? 16 : 32;
                    const geometry = new THREE.SphereGeometry(1, geometryDetail, geometryDetail);
                    const material = new THREE.MeshLambertMaterial({ color: 0xcccccc });
                    head = new THREE.Mesh(geometry, material);
                    scene.add(head);
                    
                    // Grupo para hotspots
                    hotspotsGroup = new THREE.Group();
                    head.add(hotspotsGroup);
                    
                    // Touch controls para móvil
                    if (isMobile && 'ontouchstart' in window) {
                        let touchStartX = 0;
                        let touchStartY = 0;
                        let isRotating = false;
                        
                        renderer.domElement.addEventListener('touchstart', (e) => {
                            e.preventDefault();
                            touchStartX = e.touches[0].clientX;
                            touchStartY = e.touches[0].clientY;
                            isRotating = true;
                        });
                        
                        renderer.domElement.addEventListener('touchmove', (e) => {
                            e.preventDefault();
                            if (!isRotating || !head) return;
                            
                            const deltaX = e.touches[0].clientX - touchStartX;
                            const deltaY = e.touches[0].clientY - touchStartY;
                            
                            // Rotar modelo basado en touch
                            head.rotation.y += deltaX * 0.01;
                            head.rotation.x += deltaY * 0.01;
                            
                            touchStartX = e.touches[0].clientX;
                            touchStartY = e.touches[0].clientY;
                        });
                        
                        renderer.domElement.addEventListener('touchend', () => {
                            isRotating = false;
                        });
                        
                        // Prevenir zoom en el canvas
                        renderer.domElement.style.touchAction = 'none';
                    }
                    
                    // Re-crear elementos overlay
                    const newMatrixEffect = document.createElement('div');
                    newMatrixEffect.id = 'matrix-effect';
                    newMatrixEffect.className = 'matrix-effect';
                    vizContainer.appendChild(newMatrixEffect);
                    
                    const newCriticalAlert = document.createElement('div');
                    newCriticalAlert.id = 'critical-alert';
                    newCriticalAlert.className = 'critical-alert';
                    vizContainer.appendChild(newCriticalAlert);
                    
                    // Métricas live
                    const liveMetrics = document.createElement('div');
                    liveMetrics.id = 'live-metrics';
                    liveMetrics.innerHTML = `
                        <div>FPS: <span id="fps-counter">60</span></div>
                        <div>Resolución: ${width}x${height}</div>
                        <div>Dispositivo: ${isMobile ? 'Móvil' : 'Desktop'}</div>
                    `;
                    vizContainer.appendChild(liveMetrics);
                    
                    // Actualizar referencias
                    matrixEffectEl = newMatrixEffect;
                    criticalAlertEl = newCriticalAlert;
                    
                    // Animación
                    function animate() {
                        requestAnimationFrame(animate);
                        if (head) head.rotation.y += 0.01;
                        if (renderer && scene && camera) {
                            renderer.render(scene, camera);
                        }
                    }
                    animate();
                    
                    console.log('✅ THREE.js inicializado correctamente');
                    
                } catch (error) {
                    console.error('💥 Error en initThreeJS:', error);
                    vizContainer.innerHTML = '<div style="color: red; padding: 20px;">Error: ' + error.message + '</div>';
                }
            }

            function animate() {
                if (!scene || !camera || !renderer || !head) {
                    console.warn('⚠️ Componentes Three.js no disponibles para animación');
                    // Intentar reinicializar después de 1 segundo
                    setTimeout(() => {
                        if (vizContainer && typeof THREE !== 'undefined') {
                            console.log('🔄 Intentando reinicializar Three.js...');
                            initThreeJS();
                        }
                    }, 1000);
                    return;
                }
                
                try {
                    animationFrameId = requestAnimationFrame(animate);
                    
                    // 🎬 ANIMACIONES ESPECTACULARES
                    
                    // Rotación suave del modelo principal
                    head.rotation.y += 0.01;
                    head.rotation.x += 0.005;
                    
                    // 🌟 ROTACIÓN DE PARTÍCULAS
                    if (particles) {
                        particles.rotation.y += 0.002;
                        particles.rotation.x += 0.001;
                    }

                    // 💫 PULSACIÓN DE HOTSPOTS
                    if (hotspotsGroup && hotspotsGroup.children.length > 0) {
                        hotspotsGroup.children.forEach((hotspot, index) => {
                            const time = Date.now() * 0.005;
                            hotspot.scale.setScalar(1 + Math.sin(time + index) * 0.3);
                            if (hotspot.material && hotspot.material.opacity !== undefined) {
                                hotspot.material.opacity = 0.5 + Math.sin(time + index) * 0.3;
                            }
                        });
                    }

                    // 🎥 CAMERA SMOOTH MOVEMENT (movimiento cinematográfico sutil)
                    const time = Date.now() * 0.0005;
                    camera.position.x = Math.sin(time) * 0.3;
                    camera.position.y = Math.cos(time * 0.7) * 0.2;
                    camera.lookAt(head.position);
                    
                    // Render con verificación
                    renderer.render(scene, camera);
                    
                } catch (error) {
                    console.error('💥 Error en animate:', error);
                    console.log('🛑 Deteniendo animación');
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                    }
                    
                    // Mostrar error en container
                    if (vizContainer) {
                        vizContainer.innerHTML = `
                            <div style="color: #F87171; text-align: center; padding: 20px; background: #1F2937; border-radius: 8px;">
                                ❌ Error animación: ${error.message}<br>
                                <button onclick="window.location.reload()" style="margin-top: 10px; padding: 5px 10px; background: #04D9FF; color: #111827; border: none; border-radius: 4px; cursor: pointer;">🔄 Recargar</button>
                            </div>
                        `;
                    }
                }
            }
            
            // Resize handler mejorado con debounce
            function handleResize() {
                if (!renderer || !camera || !vizContainer) return;
                
                const rect = vizContainer.getBoundingClientRect();
                const width = rect.width;
                const height = rect.height;
                
                if (width > 0 && height > 0) {
                    camera.aspect = width / height;
                    camera.updateProjectionMatrix();
                    renderer.setSize(width, height);
                    
                    // Actualizar métricas live
                    const liveMetrics = document.getElementById('live-metrics');
                    if (liveMetrics) {
                        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                        liveMetrics.innerHTML = `
                            <div>FPS: <span id="fps-counter">60</span></div>
                            <div>Resolución: ${width}x${height}</div>
                            <div>Dispositivo: ${isMobile ? 'Móvil' : 'Desktop'}</div>
                        `;
                    }
                    
                    console.log(`📐 Resize: ${width}x${height}`);
                }
            }

            // Resize con debounce para performance
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(handleResize, 150);
            });
            
            function runVisualizationSequence(patient, steps) {
                let cumulativeDelay = 0;
                
                switchToView('rgb'); // Start with RGB

                steps.forEach(step => {
                    setTimeout(() => {
                        if(step.view === 'fused') {
                            matrixEffectEl.style.opacity = 1;
                            setTimeout(() => {
                                matrixEffectEl.style.opacity = 0;
                                switchToView(step.view, patient);
                            }, 1000);
                        } else {
                            switchToView(step.view, patient);
                        }
                    }, cumulativeDelay);
                    cumulativeDelay += step.duration;
                });
            }

            function switchToView(view, patient = null) {
                console.log(`🎯 Transición cinematográfica a: ${view}`);
                
                // VERIFICACIÓN CRÍTICA
                if (!head || !hotspotsGroup || !criticalAlertEl) {
                    console.warn('⚠️ Elementos 3D no disponibles para cambio de vista');
                    return;
                }
                
                // 🎵 EFECTO DE SONIDO PARA TRANSICIÓN
                playBeep(600, 150);
                
                currentView = view;
                
                // ACTUALIZAR BOTONES
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                const currentBtn = document.querySelector(`.view-btn[data-view="${view}"]`);
                if (currentBtn) currentBtn.classList.add('active');
                
                // LIMPIAR HOTSPOTS
                while(hotspotsGroup.children.length > 0) {
                    const child = hotspotsGroup.children[0];
                    hotspotsGroup.remove(child);
                    if(child.geometry) child.geometry.dispose();
                    if(child.material) child.material.dispose();
                }
                
                // LIMPIAR ALERTA
                criticalAlertEl.style.opacity = 0;
                
                // 🎬 TRANSICIÓN CINEMATOGRÁFICA CON FADE
                head.material.transparent = true;
                const fadeOut = new THREE.Clock();
                
                function fadeTransition() {
                    const elapsed = fadeOut.getElapsedTime();
                    head.material.opacity = Math.max(0, 1 - elapsed * 2);
                    
                    if (elapsed < 0.5) {
                        requestAnimationFrame(fadeTransition);
                    } else {
                        // CAMBIAR MATERIAL SEGÚN VISTA
                        switch(view) {
                            case 'rgb':
                                head.material = new THREE.MeshPhongMaterial({ 
                                    color: 0xcccccc,
                                    shininess: 100,
                                    transparent: true,
                                    opacity: 0
                                });
                                console.log('📷 Vista RGB con transición');
                                break;
                                
                            case 'thermal':
                                // GENERAR TEXTURA TÉRMICA ANIMADA
                                const canvas = document.createElement('canvas');
                                canvas.width = 256;
                                canvas.height = 256;
                                const context = canvas.getContext('2d');
                                
                                const gradient = context.createRadialGradient(128, 128, 0, 128, 128, 128);
                                gradient.addColorStop(0, '#ff0000');
                                gradient.addColorStop(0.3, '#ff8800');
                                gradient.addColorStop(0.6, '#ffff00');
                                gradient.addColorStop(0.8, '#00ff00');
                                gradient.addColorStop(1, '#0088ff');
                                
                                context.fillStyle = gradient;
                                context.fillRect(0, 0, 256, 256);
                                
                                head.material = new THREE.MeshBasicMaterial({ 
                                    map: new THREE.CanvasTexture(canvas),
                                    transparent: true,
                                    opacity: 0
                                });
                                console.log('🌡️ Vista térmica con transición');
                                break;
                                
                            case 'fused':
                                head.material = new THREE.MeshStandardMaterial({ 
                                    color: 0x04D9FF,
                                    wireframe: true,
                                    transparent: true,
                                    opacity: 0
                                });
                                
                                // AGREGAR HOTSPOTS SI DISPONIBLES
                                if (patient && patient.hotspots && patient.hotspots.length > 0) {
                                    patient.hotspots.forEach(spot => {
                                        const hotspotGeometry = new THREE.SphereGeometry(0.1, 16, 16);
                                        const hotspotMaterial = new THREE.MeshBasicMaterial({ 
                                            color: 0xF87171, 
                                            transparent: true, 
                                            opacity: 0.8 
                                        });
                                        const hotspot = new THREE.Mesh(hotspotGeometry, hotspotMaterial);
                                        hotspot.position.set(spot.position.x, spot.position.y, spot.position.z);
                                        hotspot.position.multiplyScalar(1.5);
                                        hotspotsGroup.add(hotspot);
                                        
                                        // MOSTRAR ALERTA
                                        criticalAlertEl.textContent = spot.message;
                                        criticalAlertEl.style.opacity = 1;
                                    });
                                } else {
                                    // ALERTA GENÉRICA PARA DEMO
                                    criticalAlertEl.textContent = 'FUSIÓN IA ACTIVA - ANÁLISIS PROFUNDO';
                                    criticalAlertEl.style.opacity = 1;
                                }
                                
                                console.log('🔬 Vista fusión IA con transición');
                                break;
                        }
                        
                        // 🎬 FADE IN
                        const fadeIn = new THREE.Clock();
                        function fadeInTransition() {
                            const elapsed = fadeIn.getElapsedTime();
                            head.material.opacity = Math.min(1, elapsed * 2);
                            
                            if (elapsed < 0.5) {
                                requestAnimationFrame(fadeInTransition);
                            }
                        }
                        fadeInTransition();
                    }
                }
                fadeTransition();
            }
            
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // 🎬 EFECTO CINEMATOGRÁFICO AL HACER CLIC
                    const cinematicOverlay = document.getElementById('cinematic-overlay');
                    if (cinematicOverlay) {
                        cinematicOverlay.classList.add('active');
                        setTimeout(() => {
                            cinematicOverlay.classList.remove('active');
                        }, 2000);
                    }
                    
                    // 🎵 SONIDO DE INTERACCIÓN
                    playBeep(800, 100);
                    
                    const patientKey = document.querySelector('.patient-btn.border-primary')?.dataset.patient;
                    if (patientKey) {
                        switchToView(btn.dataset.view, patientData[patientKey]);
                    }
                });
            });

            window.addEventListener('resize', () => {
                if (renderer && camera && vizContainer) {
                    try {
                        const width = vizContainer.clientWidth;
                        const height = vizContainer.clientHeight;
                        
                        if (width > 0 && height > 0) {
                            camera.aspect = width / height;
                            camera.updateProjectionMatrix();
                            renderer.setSize(width, height);
                            console.log('🔄 Resize aplicado:', { width, height });
                        }
                    } catch (error) {
                        console.error('💥 Error en resize:', error);
                    }
                } else {
                    console.warn('⚠️ Resize ignorado - componentes no disponibles');
                }
            });

            // Initial setup
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
            
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('main section');
            const headerHeight = document.getElementById('header').offsetHeight;

            function updateActiveNav() {
                let currentSectionId = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop - headerHeight - 50;
                    if (window.scrollY >= sectionTop) {
                        currentSectionId = section.getAttribute('id');
                    }
                });
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${currentSectionId}`) {
                        link.classList.add('active');
                    }
                });
            }
            
            // Tech Mode Toggle Logic
            const techToggle = document.getElementById('tech-mode-toggle');
            const techToggleMobile = document.getElementById('tech-mode-toggle-mobile');
            const body = document.body;

            function setTechMode(isTechMode) {
                if (isTechMode) {
                    body.classList.add('tech-mode');
                } else {
                    body.classList.remove('tech-mode');
                }
                techToggle.checked = isTechMode;
                techToggleMobile.checked = isTechMode;
            }

            techToggle.addEventListener('change', (e) => setTechMode(e.target.checked));
            techToggleMobile.addEventListener('change', (e) => setTechMode(e.target.checked));

            document.querySelectorAll('.tech-details-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const details = button.nextElementSibling;
                    details.style.display = details.style.display === 'block' ? 'none' : 'block';
                });
            });

            // Modal Logic
            const modal = document.getElementById('formula-modal');
            const indiceCard = document.getElementById('indice-card');
            const closeModal = document.getElementById('close-formula-modal');

            indiceCard.onclick = function() {
                modal.style.display = "block";
            }
            closeModal.onclick = function() {
                modal.style.display = "none";
            }
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }

            // Mobile Menu Logic
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
                mobileMenuButton.querySelector('svg.block').classList.toggle('hidden');
                mobileMenuButton.querySelector('svg.hidden').classList.toggle('hidden');
            });
            mobileMenu.addEventListener('click', (e) => {
                if(e.target.tagName === 'A') {
                    mobileMenu.classList.add('hidden');
                    mobileMenuButton.querySelector('svg.block').classList.remove('hidden');
                    mobileMenuButton.querySelector('svg.hidden').classList.add('hidden');
                }
            });
            
            window.addEventListener('scroll', updateActiveNav);
            
            createMarketChart();
            createCompetitorChart();
            
            // 🌟 CREAR EFECTO DE PARTÍCULAS FLOTANTES EN EL CONTAINER
            function createFloatingParticles() {
                const container = document.getElementById('threejs-container');
                if (!container) return;
                
                for (let i = 0; i < 15; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle-trail';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.top = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 3 + 's';
                    particle.style.animationDuration = (2 + Math.random() * 2) + 's';
                    container.appendChild(particle);
                    
                    // Auto-remover después de 10 segundos
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 10000);
                }
            }

            // Mostrar indicador de carga con efectos
            const container = document.getElementById('threejs-container');
            container.innerHTML = '<div class="flex items-center justify-center h-full text-primary">🔄 Cargando visualización 3D avanzada...</div>';
            
            // Crear partículas flotantes durante la carga
            createFloatingParticles();
            
            // 🎵 SONIDO DE INICIO DEL SISTEMA
            setTimeout(() => {
                playBeep(300, 100);
                setTimeout(() => playBeep(400, 100), 150);
                setTimeout(() => playBeep(500, 150), 300);
            }, 500);
            
            // Inicialización segura del sistema 3D
            setTimeout(() => {
                console.log('🚀 Iniciando sistema 3D avanzado...');
                console.log('🔍 Pre-init check:', {
                    THREE: typeof THREE,
                    container: !!vizContainer,
                    containerInDOM: !!document.getElementById('threejs-container'),
                    containerWidth: vizContainer?.clientWidth,
                    containerHeight: vizContainer?.clientHeight
                });
                
                const success = initThreeJS();
                console.log('🎯 initThreeJS result:', success);
                
                if (success) {
                    // 🎵 SONIDO DE ÉXITO
                    playBeep(800, 200);
                    
                    console.log('🎉 Sistema completamente funcional con efectos avanzados');
                    console.log('📊 Post-init state:', {
                        scene: !!scene,
                        camera: !!camera,
                        renderer: !!renderer,
                        head: !!head,
                        particles: !!particles,
                        rendererDomElement: !!renderer?.domElement
                    });
                    
                    // Crear más partículas de celebración
                    setTimeout(createFloatingParticles, 1000);
                } else {
                    // 🎵 SONIDO DE ERROR
                    playBeep(200, 300);
                    console.log('❌ Sistema 3D falló - Ver errores arriba');
                }
            }, 1000);

            // ===============================================================
            // 🎯 SISTEMA DE DIAGNÓSTICO Y SOLUCIÓN DEFINITIVA THREE.JS
            // ===============================================================
            // Autor: HombreVigente Team
            // Propósito: Sistema completo para diagnosticar y solucionar 
            //           problemas de visualización 3D en tiempo real
            // Funcionalidades:
            // - Diagnóstico exhaustivo de 7 componentes críticos
            // - Funciones de emergencia para recuperación automática
            // - Botones de control integrados en el container 3D
            // - Variables globales accesibles para debugging manual
            // ===============================================================

                         /**
              * 🔍 FUNCIÓN DE DIAGNÓSTICO QUIRÚRGICA
              * Versión simplificada y directa para debug rápido
              */
             window.testThreeJS = function() {
                 console.log('🔍 === DIAGNÓSTICO COMPLETO THREE.JS ===');
                 console.log('THREE disponible:', typeof THREE);
                 console.log('Variables globales:', { scene: !!scene, camera: !!camera, renderer: !!renderer, head: !!head });
                 
                 if (renderer) {
                     console.log('Renderer info:', {
                         domElement: !!renderer.domElement,
                         context: renderer.getContext(),
                         size: { width: renderer.domElement.width, height: renderer.domElement.height }
                     });
                 }
                 
                 if (vizContainer) {
                     console.log('Container info:', {
                         dimensions: { width: vizContainer.clientWidth, height: vizContainer.clientHeight },
                         children: vizContainer.children.length,
                         hasCanvas: !!vizContainer.querySelector('canvas')
                     });
                 }
                 
                 if (head) {
                     console.log('Head model:', {
                         position: head.position,
                         visible: head.visible,
                         inScene: scene && scene.children.includes(head)
                     });
                 }
             };

            /**
             * ⏰ AUTO-EJECUCIÓN DE DIAGNÓSTICO
             * Se ejecuta automáticamente 2 segundos después de la carga
             * para verificar el estado inicial del sistema
             */
            setTimeout(() => {
                console.log('🚀 Ejecutando diagnóstico automático...');
                const isHealthy = window.testThreeJS();
                
                // Mostrar notificación visual del estado
                const container = document.getElementById('threejs-container');
                if (container) {
                    const statusDiv = document.createElement('div');
                    statusDiv.style.cssText = `
                        position: absolute; 
                        top: 5px; 
                        right: 5px; 
                        padding: 3px 8px; 
                        border-radius: 12px; 
                        font-size: 10px; 
                        font-weight: bold; 
                        z-index: 200;
                        ${isHealthy ? 
                            'background: #10B981; color: white;' : 
                            'background: #EF4444; color: white;'
                        }
                    `;
                    statusDiv.textContent = isHealthy ? '✅ Sistema OK' : '⚠️ Problemas detectados';
                    container.appendChild(statusDiv);
                    
                    // Auto-ocultar después de 5 segundos
                    setTimeout(() => statusDiv.remove(), 5000);
                }
            }, 2000);

            // ===============================================================
            // 🚨 FUNCIONES DE EMERGENCIA Y RECUPERACIÓN
            // ===============================================================

                         /**
              * 🔄 FUNCIÓN DE RENDER FORZADO QUIRÚRGICA
              * Fuerza múltiples renders para máxima visibilidad
              */
             window.forceRender = function() {
                 if (renderer && scene && camera) {
                     for (let i = 0; i < 10; i++) {
                         renderer.render(scene, camera);
                     }
                     console.log('🎨 Force render ejecutado 10 veces');
                 } else {
                     console.error('❌ No se puede forzar render - componentes no disponibles');
                 }
             };

                         /**
              * 🛠️ FUNCIÓN DE RECREACIÓN QUIRÚRGICA
              * Reinicia completamente el sistema Three.js
              */
             window.recreateThreeJS = function() {
                 console.log('🔄 Recreando Three.js completamente...');
                 
                 // Limpiar variables globales
                 if (animationFrameId) {
                     cancelAnimationFrame(animationFrameId);
                 }
                 
                 scene = null;
                 camera = null;
                 renderer = null;
                 head = null;
                 hotspotsGroup = null;
                 
                 // Reinicializar
                 setTimeout(() => {
                     initThreeJS();
                 }, 500);
             };

            /**
             * 💬 FUNCIÓN AUXILIAR PARA MOSTRAR MENSAJES DE ESTADO
             * Muestra notificaciones visuales en el container 3D
             */
            function showStatusMessage(message, type = 'info') {
                const container = document.getElementById('threejs-container');
                if (!container) return;
                
                const statusDiv = document.createElement('div');
                const colors = {
                    success: 'background: #10B981; color: white;',
                    error: 'background: #EF4444; color: white;',
                    warning: 'background: #F59E0B; color: white;',
                    info: 'background: #3B82F6; color: white;'
                };
                
                statusDiv.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    padding: 8px 16px;
                    border-radius: 8px;
                    font-size: 12px;
                    font-weight: bold;
                    z-index: 300;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    ${colors[type] || colors.info}
                `;
                statusDiv.textContent = message;
                container.appendChild(statusDiv);
                
                // Auto-remover después de 3 segundos
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.parentNode.removeChild(statusDiv);
                    }
                }, 3000);
            }

            // ===============================================================
            // 🌐 VARIABLES GLOBALES PARA DEBUGGING
            // ===============================================================
            // Hacer variables principales accesibles desde la consola
            // Uso: Abrir DevTools y escribir "window.scene" para inspeccionar
            
            /**
             * Actualiza las referencias globales para debugging
             * Se llama automáticamente después de cada inicialización
             */
            function updateGlobalReferences() {
                window.scene = scene;
                window.camera = camera;
                window.renderer = renderer;
                window.head = head;
                window.hotspotsGroup = hotspotsGroup;
                window.vizContainer = vizContainer;
                
                // Funciones de utilidad adicionales
                window.getThreeJSInfo = function() {
                    return {
                        version: THREE?.REVISION,
                        scene: scene ? {
                            children: scene.children.length,
                            background: scene.background,
                            fog: !!scene.fog
                        } : null,
                        camera: camera ? {
                            type: camera.constructor.name,
                            position: camera.position,
                            fov: camera.fov,
                            aspect: camera.aspect
                        } : null,
                        renderer: renderer ? {
                            type: renderer.constructor.name,
                            size: renderer.getSize(new THREE.Vector2()),
                            pixelRatio: renderer.getPixelRatio(),
                            shadowMap: renderer.shadowMap.enabled
                        } : null,
                        head: head ? {
                            visible: head.visible,
                            position: head.position,
                            material: head.material?.constructor.name,
                            geometry: head.geometry?.constructor.name
                        } : null
                    };
                };
                
                console.log('🌐 Referencias globales actualizadas para debugging');
            }
            
            // Actualizar referencias iniciales
            updateGlobalReferences();
            
            // ===============================================================
            // 📋 RESUMEN DE FUNCIONES DISPONIBLES
            // ===============================================================
            console.log('\n📋 === FUNCIONES DE DIAGNÓSTICO DISPONIBLES ===');
            console.log('🔍 window.testThreeJS()     - Diagnóstico completo');
            console.log('🔄 window.forceRender()     - Render forzado');
            console.log('🛠️ window.recreateThreeJS() - Recrear sistema');
            console.log('📊 window.getThreeJSInfo()  - Info del sistema');
            console.log('🌐 window.scene, window.camera, window.renderer - Variables globales');
            console.log('===============================================\n');
        });
    </script>

    <!-- SCRIPT TEMPORAL DE VERIFICACIÓN MÓVIL -->
    <script>
        console.log('🔍 VERIFICACIÓN MÓVIL DIAGNOSTICOVIGENTE AI:');
        console.log('Container height:', document.getElementById('threejs-container')?.style.height);
        console.log('Viewport width:', window.innerWidth);
        console.log('Is mobile detected:', /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));

        // Test touch events
        if ('ontouchstart' in window) {
            console.log('✅ Touch events supported');
        } else {
            console.log('❌ Touch events NOT supported');
        }

        // Test responsive CSS
        const container = document.getElementById('threejs-container');
        if (container) {
            const styles = window.getComputedStyle(container);
            console.log('Container computed height:', styles.height);
            console.log('Container computed width:', styles.width);
            console.log('Container aspect-ratio:', styles.aspectRatio);
        }

        // Test demo grid
        const demoGrid = document.querySelector('.demo-grid');
        if (demoGrid) {
            const gridStyles = window.getComputedStyle(demoGrid);
            console.log('Demo grid columns:', gridStyles.gridTemplateColumns);
        }

        // Test view buttons
        const viewBtns = document.querySelectorAll('.view-btn');
        if (viewBtns.length > 0) {
            const btnStyles = window.getComputedStyle(viewBtns[0]);
            console.log('View button min-height:', btnStyles.minHeight);
            console.log('View button padding:', btnStyles.padding);
        }

        console.log('🎯 Abre DevTools → Toggle Device Toolbar para probar móvil');
    </script>
</body>
</html>
